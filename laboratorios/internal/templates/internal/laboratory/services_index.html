{% extends 'internal/base_internal.html' %}

{% block title %}{{ super() }} | Inicio{% endblock title %}

{% block custom_css %}
<link href="{{ static('vendors/footable/footable.core.css') }}" rel="stylesheet">
{% endblock custom_css %}

{% block page_content %}
<div class="row border-bottom white-bg dashboard-header">
    <div class="col-md-6">
        <h2><strong>{{ laboratory.name }}</strong></h2>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight" >
  <div class="col-lg-12">
    <div class="ibox float-e-margins">
      <div class="ibox-content">
        <div class="table-responsive">
          <form action="{{ url('internal:laboratory.services_index', pk=laboratory.pk) }}" method="post" >
            <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper form-inline dt-bootstrap">
               <div class="input-group">
                   <input type="text" class="form-control input-sm m-b-xs" id="mysearch" placeholder="Buscar">
                  <span class="input-group-addon">
                      <i class="fa fa-search"></i>
                  </span>
                </div>
              <table class="table table-striped table-bordered table-hover dataTables-example display dataTable fn.dataTable.defaults" id="DataTables_Table_0">
                <thead>
                  <tr role="row">
                    <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending" >
                      N°
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">
                      Cliente
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">
                      Supervisor
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">
                      Estado
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">
                      Acciones
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {% for service in laboratory_services %}
                    <tr role="row">
                      <td>{{ loop.index }}</td>
                      <td>{{ service.client }}</td>
                      <td>{{ service.supervisor }}</td>
                      <td>{{ service.state }}</td>
                      <td class="text-left footable-visible footable-last-column">
                        <div class="btn-group">
                          <a  href="{{ url('internal:laboratory.show', laboratory.id) }}" class="btn-white btn"><i class="fa fa-eye" aria-hidden="true"></i></a>
                          <select class="form-control m-b" id="comboBox">
                            {% if not service.priority %}
                              <option id="-1" name="" selected>------</option>
                            {% endif %}
                            {% for priority in priorities %}
                              {% if (service.priority == priority) %}
                                <option selected id="{{ priority.pk }}" name="{{ service.pk }}" >{{ priority.slug }}</option>
                              {% else %}
                                <option id="{{ priority.pk }}" name="{{ service.pk }}" >{{ priority.slug }}</option>
                              {% endif %}
                            {% endfor %}
                          </select>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
              <div class="col-md-offset-4">
              <input type="button" onclick="send_priority_changes()" class="btn btn-primary" name="registrar" id="register_button" value="Guardar Cambios">
              <a href="{{ url('internal:laboratory.index') }}" class="btn btn-white">Cancelar </a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock page_content %}


{% block custom_js %}

<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>
<script type="text/javascript">

function send_priority_changes(){
  var services_pk = [];
  var priorities_pk = [];
  var i;
  $('select option:selected').each(function(){
    services_pk.push($(this).attr("name"));
    priorities_pk.push($(this).attr("id"));
  });
  $.post("{{ url('internal:laboratory.services_index', pk=laboratory.pk)}}", {'services_pk': services_pk, 'priorities_pk': priorities_pk},function(e){
    window.location.assign("{{ url('internal:laboratory.index') }}")
  });
}

$(document).ready(function() {
 
    // DataTable
    var table = $('#DataTables_Table_0').DataTable({
      "lengthChange": false,
      "bsort":true,
      "sDom": '<"top"i>rt<"bottom"lp><"clear">',
      "columnDefs": [
        { "orderable": false, "targets": 4 }
      ],
      "columnDefs": [
        { "searchable": false, "targets": 0 }
      ],
      "sPaginationType": "full_numbers",
      "pageLength": 6,
      "oLanguage": {
        "oPaginate": {
                    "sPrevious": " Anterior ",
                    "sNext" : " Siguiente ",
                    "sFirst": "<<",
                    "sLast": ">>"
                    },
        "sZeroRecords":    "No se encontraron resultados",
        "sEmptyTable":     "Ningún dato disponible en esta tabla",
        "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
        "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
        "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
        "oAria": {
        "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
    }
  
       }

    });

    $('#mysearch').keyup(function(){
      table.search($(this).val()).draw() ;
})
} );

</script>

{% endblock custom_js %}
