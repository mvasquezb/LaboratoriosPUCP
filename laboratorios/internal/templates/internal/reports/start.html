{% extends 'internal/base_internal.html' %}


{% block page_content %}
<div class="row border-bottom white-bg dashboard-header">
    <div class="col-md-6">
        <h2><strong>Reportes</strong></h2>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <h3><strong>Criteria</strong></h3>
    <label class="col-sm-2 control-label">Rango de Fechas</label>
    <div class="col-sm-4">
    <div id="reportrange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
        <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>&nbsp;
        <span></span> <b class="caret"></b>
    </div>
    </div>
    <br>
    <br>
    <br>
    <div id=criteriaInsertion>
    </div>
</div>
{% endblock page_content %}


{% block custom_js %}
<script type="text/javascript" src="{{static('js/icheck.min.js')}}"></script>
<script type="test/javascript" src="{{static('js/chosen.jquery.js')}}"></script>
<script type="text/javascript" src="{{static('js/moment.js')}}"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />
<script type="text/javascript">
$(function() {

    var start = moment().subtract(29, 'days');
    var end = moment();

    function cb(start, end) {
        $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
    }

    $('#reportrange').daterangepicker({
        startDate: start,
        endDate: end,
        ranges: {
           'Today': [moment(), moment()],
           'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
           'Last 7 Days': [moment().subtract(6, 'days'), moment()],
           'Last 30 Days': [moment().subtract(29, 'days'), moment()],
           'This Month': [moment().startOf('month'), moment().endOf('month')],
           'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        }
    }, cb);

    cb(start, end);
    
});
</script>
<script type="text/javascript">
$(document).ready(function(){
    var criteria = {{ criteria | safe}};
    var criteria_string = {{ criteria_string | safe}};
    var data_list = {{ data_list | safe}};    
    for(var i=0;i<criteria.length;i++){
        console.log(data_list[criteria[i]]);
        
            
        $('#criteriaInsertion').append(
            '<label class="col-sm-2 control-label">'+criteria_string[criteria[i]]+'</label>'
                +'<div class="col-sm-10"><input id=p_'+i+' type="checkbox" name="input" value="check" onclick=checkMe(this.id) > Primario'
            +'<input id=s_'+i+' type="checkbox" name="input" value="check" onclick=checkMe(this.id) > Secundario '
            +'<div class="col-lg-6">'
                            +'<div id=list_'+i.toString()+' class="form-group hidden">'
                                +'<label>Seleccione l@s '+ criteria_string[criteria[i]]+'s: </label>'
                                +'<div class="table-responsive">'
                                    +'<table class="table table-striped table-bordered permission_table">'
                                      +'<thead>'
                                        +'<tr>'
                                          +'<th>Nombre de '+criteria_string[criteria[i]]+'</th>'                                          
                                          +'<th>Selecci√≥n</th>'
                                        +'</tr>'
                                      +'</thead>'
                                      +'<tbody id=body_'+i.toString()+'>'
                                      +'</tbody>'
                                    +'</table>'
                                +'</div>'
                            +'</div>'
                        +'</div>'
                +'</div>'
            +'<br>'
            +'<br>'
            +'<br>'
            +'<br>'
            +'<br>'
            +'<br>'
            +'<br>'
            +'<br>'
            +'<br>'
        );
        for (var j=0;j<data_list[criteria[i]].length;j++){
            $('#body_'+i.toString()).append(
                                          +'<tr>'
                                            +'<td>'+ data_list[criteria[i]][j]+'</td>'
                                            +'<td><input type="checkbox" name="value" class="i-checks checkbox_role"></td>'
                                          +'</tr>'
            );
        }
    }
    
    checkMe=function(id){
        console.log(document.getElementById(id).checked);
        // Check the other one for same criteria
        console.log(id[0]);
        if (id[0]=='p'){
            document.getElementById(id.replace('p','s')).checked=false;

            // Check if another criteria is checked as main one
            for(var i=0;i<criteria.length;i++){
                if (i != parseInt(id.replace('p_',''))){
                    document.getElementById('p_'+i.toString()).checked=false;
                    $('#list_'+i.toString()).addClass('hidden');
                }
            }
        }else{
            document.getElementById(id.replace('s','p')).checked=false;

            // Check if all are checked as secondary, then alert
            var checked=0;
            for(var i=0;i<criteria.length;i++){
                if (document.getElementById('s_'+i.toString()).checked){
                    checked = checked + 1;
                }
            }
            if (checked == criteria.length){
                alert('Debe seleccionar un criterio principal!');
                document.getElementById(id).checked=false;
            }
        }
        if (document.getElementById(id).checked == false){
                $('#list_'+id[2]).addClass('hidden');
            }else{
                $('#list_'+id[2]).removeClass('hidden');
            }
    }
    
    


    function uploadData(insert_data){
        var data = {js_data: insert_data,
                    csrfmiddlewaretoken: csrftoken};
        $.post('/internal/essay/create', JSON.stringify(data), function(response){
            console.log(data['csrfmiddlewaretoken'])
            });
    }




    
});
</script>

{% endblock custom_js %}
