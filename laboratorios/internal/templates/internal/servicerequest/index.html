{% extends 'internal/base_internal.html' %}

{% block title %}{{ super() }} | Solicitudes{% endblock title %}

{% block custom_css %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
{% endblock custom_css %}

{% block page_content %}
<div class="row border-bottom white-bg dashboard-header">
  <div class="col-md-6">
    <h2><strong>Listado de Solicitudes</strong></h2>
  </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
  <div class="col-lg-12">
    <div class="text-right">
      <a class="btn btn-primary" href="{{ url('internal:servicerequest.select_client') }}">
        <i class="fa fa-plus"></i>
        Crear Solicitud
      </a>
      <a class="btn btn-primary" href="{{ url('internal:servicerequest.workload_view_per_request') }}">
        <i class="fa fa-search"></i>
        Ver Carga Laboral
      </a>
    </div>
  </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight main-wrapper-content">
  <div class="col-lg-12">
    <div class="ibox float-e-margins">
      <div class="ibox-content">
            <div class="row">
              <div class="col-lg-12">
                <div class="table-responsive">
              <table class="table table-striped table-bordered" id="request-table">
               <thead>
                  <tr>
                     <th>#</th>
                     <th>Cliente</th>
                     <th>Responsable</th>
                     <th>Acciones</th>
                  </tr>
               </thead>
               <tbody>
                  {% for request in requests %}
                    {% if request.state.description != "Verificado"  %}      <!--  Esto es para no mostrar las solicitudes que han sido aprobadas, pues se convierten en contratos-->

                    <tr>
                      <td>{{ loop.index }}</td>
                      <td>{{ request.client }}</td>
                      <td>{{ request.supervisor }}</td>
                      <td>
                        <a class="btn-white btn btn-xs" href="{{ url('internal:servicerequest.edit', request.id) }}">Editar</a>
                        <a class="btn-white btn btn-xs" href="{{ url('internal:servicerequest.delete', request.id) }}">Eliminar</a>
                        <a class="btn-white btn btn-xs" href="{{ url('internal:servicerequest.approve', request.id) }}">Aprobar</a>  <!--Agregado-->
                        <a class="btn-white btn btn-xs" href="{{ url('internal:servicerequest.reportGenerator',request.id) }}">Reporte Interno</a>
                        <a class="btn-white btn btn-xs" href="{{ url('internal:servicerequest.finalReport',request.id)}}">Informe Final</a>
                      </td>
                    </tr>
                    {% endif %}
                  {% endfor %}
               </tbody>
            </table>
            </div>
              </div>
            </div>
         </div>
      </div>
   </div>
</div>
<div class="message-container hidden">
  <ul class="messages">
    {% for message in messages %}
    <li {% if message.tags %} data-tags="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
  </ul>
</div>
{% endblock page_content %}

{% block custom_js %}
<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<script src="{{ static('js/datatable-config.js') }}"></script>
<script>
if ($('.message-container .messages li')) {
  var msg = $('.message-container .messages li').first();
  $.extend(toastr.options, {"positionClass": "toast-bottom-right",});
  try {
    toastr[msg.data('tags')](msg.text());
  } catch (TypeError) {}
}
$('#attachment-table').DataTable({
  responsive: true,
});
$('#request-table').DataTable({
  responsive: true,
});
</script>
{% endblock custom_js %}
