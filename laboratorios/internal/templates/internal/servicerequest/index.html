{% extends 'internal/base_internal.html' %}

{% block title %}{{ super() }} | Solicitudes{% endblock title %}

{% block custom_css %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
{% endblock custom_css %}

{% block page_content %}
<div class="row border-bottom white-bg dashboard-header">
  <div class="col-md-6">
    <h2><strong>Listado de Solicitudes</strong></h2>
  </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
  <div class="col-lg-12">
    <div class="text-right">
      <a class="btn btn-primary" href="{{ url('internal:servicerequest.select_client') }}">
        <i class="fa fa-plus"></i>
        Crear Solicitud
      </a>
      <a class="btn btn-primary" href="{{ url('internal:servicerequest.workload_view_per_request') }}">
        <i class="fa fa-search"></i>
        Ver Carga Laboral
      </a>
    </div>
  </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight main-wrapper-content">
  <div class="col-lg-12">
    <div class="ibox float-e-margins">
      <div class="ibox-content">
            <div class="row">
              <div class="col-lg-12">
                <div class="table-responsive">
              <table class="table table-striped table-bordered" id="request-table">
               <thead>
                  <tr>
                     <th>#</th>
                     <th>Cliente</th>
                     <th>Responsable</th>
                     <th>Acciones</th>
                  </tr>
               </thead>
               <tbody>
                  {% for request in requests %}
                    {% if request.state.description != "Aprobado"  %}      <!--  Esto es para no mostrar las solicitudes que han sido aprobadas, pues se convierten en contratos-->
                      {% if request.state.description != "Modificado" %}
                      <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ request.client }}</td>
                        <td>{{ request.supervisor }}</td>
                        <td>
                          <a class="btn-white btn btn-xs" href="{{ url('internal:servicerequest.edit', request.id) }}">Editar</a>
                          <a class="btn-white btn btn-xs" href="{{ url('internal:servicerequest.delete', request.id) }}">Eliminar</a>
                          <a class="btn-white btn btn-xs" href="{{ url('internal:servicerequest.approve', request.id) }}">Aprobar</a>  <!--Agregado-->
                        </td>
                      </tr>
                      {%endif%}
                    {% endif %}
                  {% endfor %}
               </tbody>
            </table>
            </div>
              </div>
            </div>
         </div>
      </div>
   </div>
</div>
<div class="message-container hidden">
  <ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} data-tags="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
  </ul>
</div>

{% endblock page_content %}

{% block custom_js %}
<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>
<script type="text/javascript">
  var fill_Toastr = function(pMsg, pTypeMsg,pTitle){
    toastr.options = {
    closeButton: true,
    progressBar: true,
    showMethod: 'slideDown',
    positionClass: "toast-bottom-right",
    timeOut: 4000
    };

    switch(pTypeMsg){
      case "success":
      toastr.success(pMsg, '',pTitle);
      break;

      case "error":
      toastr.error(pMsg, '',pTitle);
      break;
    }
  }

</script>
<script type="text/javascript">

$(document).ready(function() {

    // DataTable
    var table = $('#request-table').DataTable({
      "lengthChange": false,
      "bsort":true,
      "sDom": '<"top"i>rt<"bottom"lp><"clear">',
      "columnDefs": [
        { "orderable": false, "targets": 4 }
      ],
      "columnDefs": [
        { "searchable": false, "targets": 0 }
      ],
      "sPaginationType": "full_numbers",
      "pageLength": 6,
      "oLanguage": {
        "oPaginate": {
                    "sPrevious": " Anterior ",
                    "sNext" : " Siguiente ",
                    "sFirst": "<<",
                    "sLast": ">>"
                    },
        "sZeroRecords":    "No se encontraron resultados",
        "sEmptyTable":     "Ning√∫n dato disponible en esta tabla",
        "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
        "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
        "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
        "oAria": {
        "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
    }

       }

    });

    $('#mysearch').keyup(function(){
      table.search($(this).val()).draw() ;
})
} );

</script>

<script>
$( document ).ready(function() {
  $(".myBtn1").click(function() {
    $("#myModal1").show();
    var delete_url = $(this).attr("data-url");
    $(".delete-laboratory").click(function() {
      window.location.href = delete_url;
    });
  });

  $(".span-close").click(function() {
    $("#myModal1").hide();
  });
});
$(".myBtn1").click(function(event) {
  event.preventDefault();
  return false;
});
</script>

{# <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<script src="{{ static('js/datatable-config.js') }}"></script> #}
<script>
// $('#request-table').DataTable({
//   responsive: true,
// });
</script>
{% endblock custom_js %}
